import{execSync as e}from"child_process";import o from"@finos/perspective";import{Uint8ArrayReader as t,ZipReader as s,TextWriter as i,TextReader as r}from"@zip.js/zip.js";import*as a from"url";import*as n from"node:fs";!async function(){const t=a.fileURLToPath(new URL(".",import.meta.url)).slice(0,-1);if(n.existsSync(`${t}/olympics.arrow`))return;e(`cd ${t} && kaggle datasets download -d heesoo37/120-years-of-olympic-history-athletes-and-results`,{stdio:"inherit"});const l=n.readFileSync(`${t}/120-years-of-olympic-history-athletes-and-results.zip`),c=new r(l),p=new s(c),m=await p.getEntries(),f=await m[0].getData(new i,{onprogress:(e,o)=>console.log(`(${e}b / ${o}b)`)});p.close();const w=await o.table(f),y=await w.view(),d=await y.to_arrow();n.writeFileSync(`${t}/olympics.arrow`,Buffer.from(d)),n.unlinkSync(`${t}/120-years-of-olympic-history-athletes-and-results.zip`),await y.delete()}();