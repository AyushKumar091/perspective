import t from"@finos/perspective";import{Uint8ArrayReader as e,ZipReader as o,TextWriter as a}from"@zip.js/zip.js";import*as n from"node:fs/promises";import*as r from"url";import*as i from"node:fs";const s=r.fileURLToPath(new URL(".",import.meta.url));!async function(){i.existsSync(`${s}/nypdccrb.arrow`)||(await n.writeFile(`${s}/nypdccrb.arrow`,await async function(n){const r=await fetch(n),i=r.body.getReader(),s=+r.headers.get("Content-Length");let c=0,l=[];for(;;){const{done:t,value:e}=await i.read();if(t)break;l.push(e),c+=e.length;let o=(100*c/s).toFixed(1);console.log(`Downloading (${o}%)`)}let w=new Uint8Array(c),p=0;for(let t of l)w.set(t,p),p+=t.length;const f=new e(w),d=new o(f),m=await d.getEntries(),b=await m[0].getData(new a,{onprogress:(t,e)=>console.log(`(${t}b / ${e}b)`)});d.close();let g=await t.table(b),y=await g.view();return new Uint8Array(await y.to_arrow())}("https://rawcdn.githack.com/new-york-civil-liberties-union/NYPD-Misconduct-Complaint-Database-Updated/f6cea944b347c96eb26b76323013640dff4b3d00/CCRB%20Complaint%20Database%20Raw%2004.28.2023.zip?min=1")),console.log("Wrote nypdccrb.arrow"))}();